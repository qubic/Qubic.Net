@if (_visible)
{
    <div class="modal d-block" tabindex="-1" style="background-color:rgba(0,0,0,0.5)" @onclick="Cancel">
        <div class="modal-dialog modal-dialog-centered" @onclick:stopPropagation="true">
            <div class="modal-content">
                <div class="modal-header py-2">
                    <h6 class="modal-title">
                        <i class="bi @IconClass me-2"></i>@Title
                    </h6>
                    <button type="button" class="btn-close btn-close-sm" @onclick="Cancel"></button>
                </div>
                <div class="modal-body small">
                    @if (BodyContent != null)
                    {
                        @BodyContent
                    }
                    else
                    {
                        @_message
                    }
                </div>
                <div class="modal-footer py-1">
                    <button class="btn btn-outline-secondary btn-sm" @onclick="Cancel">Cancel</button>
                    <button class="btn @ButtonClass btn-sm" @onclick="Confirm">@ConfirmText</button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private bool _visible;
    private string _message = "";
    private TaskCompletionSource<bool>? _tcs;

    /// <summary>Modal title. Default: "Confirm".</summary>
    [Parameter] public string Title { get; set; } = "Confirm";

    /// <summary>Bootstrap icon class. Default: "bi-exclamation-triangle".</summary>
    [Parameter] public string IconClass { get; set; } = "bi-exclamation-triangle";

    /// <summary>CSS class for the confirm button. Default: "btn-warning".</summary>
    [Parameter] public string ButtonClass { get; set; } = "btn-warning";

    /// <summary>Text on the confirm button. Default: "Confirm".</summary>
    [Parameter] public string ConfirmText { get; set; } = "Confirm";

    /// <summary>Optional rich body content (overrides message string).</summary>
    [Parameter] public RenderFragment? BodyContent { get; set; }

    /// <summary>
    /// Shows the dialog with the given message and returns true if confirmed, false if cancelled.
    /// </summary>
    public Task<bool> ShowAsync(string message)
    {
        _tcs?.TrySetResult(false);
        _message = message;
        _visible = true;
        _tcs = new TaskCompletionSource<bool>();
        StateHasChanged();
        return _tcs.Task;
    }

    private void Confirm()
    {
        _visible = false;
        _tcs?.TrySetResult(true);
        _tcs = null;
    }

    private void Cancel()
    {
        _visible = false;
        _tcs?.TrySetResult(false);
        _tcs = null;
    }
}
