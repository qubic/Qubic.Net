@page "/explorer/ipos"
@inject QubicBackendService Backend

<h4>Active IPOs</h4>
<p class="text-muted">View currently active Initial Public Offerings. (RPC only)</p>

@if (_error != null)
{
    <div class="alert alert-danger">@_error</div>
}

@if (_ipos != null)
{
    @if (_ipos.Count == 0)
    {
        <div class="alert alert-info">No active IPOs found.</div>
    }
    else
    {
        <div class="card">
            <div class="card-header">Active IPOs (@_ipos.Count)</div>
            <div class="card-body">
                <DataTable Items="_ipos">
                    <DataColumn TItem="Qubic.Rpc.Models.IpoInfo" Title="Contract" Field="@(x => Qubic.Core.QubicContracts.FormatContract((int)x.ContractIndex))" />
                    <DataColumn TItem="Qubic.Rpc.Models.IpoInfo" Title="Asset Name" Field="@(x => x.AssetName)" Filterable="true" />
                    <DataColumn TItem="Qubic.Rpc.Models.IpoInfo" Title="Contract Identity" Field="@(x => Qubic.Core.QubicContracts.GetContractIdentity((int)x.ContractIndex).ToString())">
                        <AddressDisplay Address="@(Qubic.Core.QubicContracts.GetContractIdentity((int)context.ContractIndex))" />
                    </DataColumn>
                </DataTable>
            </div>
        </div>
    }
}
else if (_loading)
{
    <span class="text-muted">Loading...</span>
}

@code {
    private IReadOnlyList<Qubic.Rpc.Models.IpoInfo>? _ipos;
    private bool _loading;
    private string? _error;

    protected override async Task OnInitializedAsync()
    {
        _loading = true;
        try
        {
            _ipos = await Backend.GetActiveIposAsync();
        }
        catch (Exception ex)
        {
            _error = ex.Message;
        }
        finally
        {
            _loading = false;
        }
    }
}
